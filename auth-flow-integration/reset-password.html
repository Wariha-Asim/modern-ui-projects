<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureAuth | Reset Password</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="navbar-brand">
            <i class="fas fa-lock"></i> SecureAuth
        </a>
        <ul class="navbar-nav">
            <li><a href="login.html" class="nav-link">Login</a></li>
            <li><a href="register.html" class="nav-link">Register</a></li>
            <li><a href="reset-password.html" class="nav-link active">Reset Password</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1>Reset Your Password</h1>
                <p>Follow the steps to secure your account</p>
            </div>
            
            <div class="card-body">
                <div class="step-indicator">
                    <div class="step active">1</div>
                    <div class="step-line"></div>
                    <div class="step">2</div>
                    <div class="step-line"></div>
                    <div class="step">3</div>
                </div>
                
                <div id="message" class="message" style="display: none;"></div>
                
               
                <div class="form-step active" id="step1">
                    <div class="form-group">
                        <label for="email">Enter your email address</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="email" placeholder="your.email@example.com">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="sendOTP()">Send Reset Code</button>
                    <div class="login-link">
                        Remember your password? <a href="login.html">Sign In</a>
                    </div>
                </div>
                
               
                <div class="form-step" id="step2">
                    <div class="form-group">
                        <label>Enter verification code</label>
                        <p style="font-size: 0.9rem; margin-bottom: 15px; color: #666;">We've sent a 6-digit code to <span id="email-display" style="font-weight: 600;"></span></p>
                        <div class="otp-container">
                            <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 1)">
                            <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 2)">
                            <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 3)">
                            <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 4)">
                            <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 5)">
                            <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 6)">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="verifyOTP()">Verify Code</button>
                    <div style="text-align: center; margin-top: 15px;">
                        <a href="#" onclick="resendOTP()" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">
                            <i class="fas fa-redo"></i> Resend Code
                        </a>
                    </div>
                    <button class="btn btn-secondary" onclick="backToStep1()" style="margin-top: 15px;">Back</button>
                </div>
                
                
                <div class="form-step" id="step3">
                    <div class="form-group">
                        <label for="new-password">New Password</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="new-password" placeholder="Enter your new password" oninput="checkPasswordStrength()">
                        </div>
                        <div class="password-strength">
                            <div class="strength-meter" id="password-strength-meter"></div>
                        </div>
                        <div class="strength-text" id="password-strength-text"></div>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="confirm-password" placeholder="Confirm your new password">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="resetPassword()">Reset Password</button>
                    <button class="btn btn-secondary" onclick="backToStep2()" style="margin-top: 15px;">Back</button>
                </div>
                
                
                <div class="form-step" id="step4">
                    <div style="text-align: center; padding: 20px 0;">
                        <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 20px;"></i>
                        <h2 style="margin-bottom: 15px;">Password Reset Successful!</h2>
                        <p style="margin-bottom: 25px; color: #666;">Your password has been successfully reset. You can now sign in with your new password.</p>
                        <a href="login.html" class="btn btn-primary">Sign In Now</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
       
        let userEmail = '';
        let otpCode = '';
        
        
        function sendOTP() {
            const email = document.getElementById('email').value;
            
            if (!email || !email.includes('@')) {
                showMessage('Please enter a valid email address', 'error');
                return;
            }
            
           
            const btn = document.querySelector('#step1 .btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            btn.disabled = true;
            
            
fetch('https://os-project-server.vercel.app/auth/send-otp', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({ email: email })
})
.then(response => {
    if (response.status === 200) {
        return response.json();
    } else if (response.status === 404) {
        throw new Error('User not found');
    } else {
        throw new Error('Error sending OTP');
    }
})
.then(data => {
    userEmail = email;
    showMessage('Verification code sent to your email', 'success');
    document.getElementById('email-display').textContent = email;
    goToStep(2);
})
.catch(error => {
    showMessage(error.message, 'error');
})

            .finally(() => {
              
                btn.innerHTML = 'Send Reset Code';
                btn.disabled = false;
            });
        }
        
        
        function verifyOTP() {
            
            const otpInputs = document.querySelectorAll('.otp-input');
            otpCode = Array.from(otpInputs).map(input => input.value).join('');
            
            if (otpCode.length !== 6) {
                showMessage('Please enter the complete 6-digit code', 'error');
                return;
            }
            
            
            const btn = document.querySelector('#step2 .btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            btn.disabled = true;
            
            
            setTimeout(() => {
                showMessage('Code verified successfully', 'success');
                goToStep(3);
                btn.innerHTML = 'Verify Code';
                btn.disabled = false;
            }, 1500);
        }
        
        
        function checkPasswordStrength() {
            const password = document.getElementById('new-password').value;
            const meter = document.getElementById('password-strength-meter');
            const text = document.getElementById('password-strength-text');
            
            if (password.length === 0) {
                meter.style.width = '0%';
                text.textContent = '';
                return;
            }
            
            
            let strength = 0;
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;
            
            meter.style.width = `${strength}%`;
            
            if (strength < 50) {
                meter.style.background = 'var(--error)';
                text.textContent = 'Weak password';
                text.style.color = 'var(--error)';
            } else if (strength < 75) {
                meter.style.background = 'var(--warning)';
                text.textContent = 'Medium strength';
                text.style.color = 'var(--warning)';
            } else {
                meter.style.background = 'var(--success)';
                text.textContent = 'Strong password';
                text.style.color = 'var(--success)';
            }
        }
        
        
        function resetPassword() {
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword.length < 8) {
                showMessage('Password must be at least 8 characters long', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }
           
            const btn = document.querySelector('#step3 .btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
            btn.disabled = true;
            
           
            fetch('https://os-project-server.vercel.app/auth/reset-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: userEmail,
                    otp: otpCode,
                    newPassword: newPassword
                })
            })
            .then(response => {
                if (response.status === 200) {
                    return response.json();
                } else if (response.status === 400) {
                    throw new Error('Invalid OTP');
                } else if (response.status === 404) {
                    throw new Error('User not found');
                } else {
                    throw new Error('Internal server error');
                }
            })
            .then(data => {
                showMessage('Password reset successfully!', 'success');
                goToStep(4);
            })
            .catch(error => {
                showMessage(error.message, 'error');
            })
            .finally(() => {
               
                btn.innerHTML = 'Reset Password';
                btn.disabled = false;
            });
        }
        
  
        function resendOTP() {
            showMessage('New code sent to your email', 'info');
        }
        
        
        function goToStep(step) {
            
            document.querySelectorAll('.form-step').forEach(el => el.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            
            
            const steps = document.querySelectorAll('.step');
            const stepLines = document.querySelectorAll('.step-line');
            
            steps.forEach((s, i) => {
                if (i + 1 < step) {
                    s.classList.add('completed');
                    s.classList.remove('active');
                } else if (i + 1 === step) {
                    s.classList.add('active');
                    s.classList.remove('completed');
                } else {
                    s.classList.remove('active', 'completed');
                }
            });
            
            stepLines.forEach((line, i) => {
                if (i + 1 < step - 1) {
                    line.classList.add('completed');
                } else {
                    line.classList.remove('completed');
                    if (i + 1 < step) {
                        line.classList.add('active');
                    } else {
                        line.classList.remove('active');
                    }
                }
            });
        }
        
        function backToStep1() {
            goToStep(1);
        }
        
        function backToStep2() {
            goToStep(2);
        }
        
        function moveToNext(input, nextIndex) {
            if (input.value.length > 0) {
                if (nextIndex <= 6) {
                    document.querySelectorAll('.otp-input')[nextIndex].focus();
                }
            }
        }
        
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>